// Generated by CoffeeScript 1.6.3
define(['underscore', 'jquery', 'brite', 'templates/WordSearchList', 'utils/logger', 'lib/jquery/jquery.transit'], function(_, $, brite, listTmpl, log) {
  var transitTime;
  transitTime = 200;
  return brite.registerView('WordListView', {
    create: function() {
      this.dao = brite.dao("Word");
      this.transition = $.Deferred().resolve();
      return this.dao.cache().then(function(cache) {
        return listTmpl.render({
          words: cache
        });
      });
    },
    init: function() {
      if (log('trace')) {
        console.debug("WordListView.init: " + this.$el.length);
      }
    },
    destroy: function() {
      if (log('trace')) {
        console.debug("WordListView.destroy");
      }
    },
    postDisplay: function() {
      if (log('trace')) {
        console.debug("WordListView.postDisplay: " + this.$el.length);
      }
    },
    hide: function() {
      var _this = this;
      if (log('trace')) {
        console.debug("WordListView.hide");
      }
      return $.Deferred(function(defer) {
        _this.$el.transition({
          opacity: 0
        }, transitTime, 'ease', function() {
          return defer.resolve(_this.$el);
        });
      });
    },
    events: {
      'click; li': function(evt) {
        var wordRef,
          _this = this;
        wordRef = $(evt.currentTarget).bEntity('Word');
        this.$el.trigger('loader', true);
        this.dao.cache({
          ID: parseInt(wordRef.id)
        }).done(function(word) {
          _this.$el.trigger('edit', {
            word: word
          });
          return _this.$el.trigger('loader', false);
        });
        return false;
      }
    },
    docEvents: {
      'search': function(evt, data) {
        var _this = this;
        if (this.transition.state() === 'resolved') {
          this.$el.trigger('loader', true);
          this.transition = this.hide();
          this.dao.list(data.field, data.text).always(function() {
            return _this.$el.trigger('loader', false);
          });
        }
      }
    },
    daoEvents: {
      'result; Word': function(evt) {
        var _this = this;
        if (evt.daoEvent.action === 'list') {
          this.transition.then(function() {
            return $.Deferred(function(transition) {
              _this.transition = transition;
              return _this.$el.html(listTmpl.render({
                words: evt.daoEvent.result
              })).css({
                x: $(window).width()
              }).transition({
                x: 0,
                opacity: 1
              }, transitTime, 'snap', function() {
                return _this.transition.resolve();
              });
            });
          });
        }
        if (log('trace')) {
          console.debug(JSON.stringify(evt.daoEvent));
        }
      }
    }
  });
});
