// Generated by CoffeeScript 1.6.3
define(['underscore', 'jquery', 'brite', 'models/WordModel'], function(_, $, brite, WordModel) {
  var WordDAO;
  return WordDAO = (function() {
    WordDAO.prototype._cache = [];

    function WordDAO() {}

    WordDAO.prototype.entityType = function() {
      return 'Word';
    };

    WordDAO.prototype.get = function(id) {};

    WordDAO.prototype.create = function(data) {
      var _this = this;
      if (data instanceof WordModel) {
        return $.post("word/create", data, null, "json").then(function(data) {
          var word;
          if (data) {
            word = _(_this._cache).findWhere({
              ID: data != null ? data.ID : void 0
            });
            if (word) {
              _(word).extend(data);
            } else {
              word = new WordModel(data);
              _this._cache.push(word);
            }
          }
          return word || $.Deferred.reject();
        }).fail(function(xhr) {
          return $('#error-log').append(xhr.responseText);
        });
      } else {
        return $.Deferred().reject();
      }
    };

    WordDAO.prototype.remove = function(id) {};

    WordDAO.prototype.removeMany = function(ids) {};

    WordDAO.prototype.update = function(data) {
      var _this = this;
      if (data instanceof WordModel) {
        return $.post("word/update", data, null, "json").then(function(data) {
          var word;
          if (data) {
            word = _(_this._cache).findWhere({
              ID: data != null ? data.ID : void 0
            });
            if (word) {
              _(word).extend(data);
            } else {
              word = new WordModel(data);
              _this._cache.push(word);
            }
          }
          return word || $.Deferred.reject();
        }).fail(function(xhr) {
          return $('#error-log').append(xhr.responseText);
        });
      } else {
        return $.Deferred().reject();
      }
    };

    WordDAO.prototype.list = function(field, value) {
      var _this = this;
      value = escape(value);
      return $.post('word/search', {
        field: field,
        value: value
      }, function() {}, 'json').then(function(data) {
        var attrs, _i, _len;
        _this._cache = [];
        for (_i = 0, _len = data.length; _i < _len; _i++) {
          attrs = data[_i];
          _this._cache.push(new WordModel(attrs));
        }
        return _this._cache;
      }).fail(function(xhr) {
        return $('#error-log').append(xhr.responseText);
      });
    };

    WordDAO.prototype.cache = function(attrs) {
      if (attrs) {
        return _(this._cache).findWhere(attrs);
      } else {
        return this._cache;
      }
    };

    return WordDAO;

  })();
});
